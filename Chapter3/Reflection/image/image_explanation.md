# Reflection 架构逻辑解析

这张图展示了一个让 AI Agent 具备“自我进化”和“从错误中学习”能力的闭环机制。其核心理念可以概括为：**执行 (Act) -> 失败/反馈 (Feedback) -> 反思 (Reflect) -> 优化 (Optimize)**。

我们可以将其分为三个关键模块来理解：

### 1. 基础交互层：行动与记录 (Bottom & Left)
这是 Agent 与外界交互的基础循环。

* **Actor (执行者)**
    * **角色**：Agent 的“手”和“决策中枢”。
    * **功能**：根据当前的记忆（短期轨迹 + 长期经验）决定下一步做什么。
    * **输出**：产生 **Action**（如写代码、搜索网页）。
* **Environment (环境)**
    * **角色**：外部世界（如 Python 解释器、搜索引擎、操作系统）。
    * **功能**：接收 Action，返回反馈。
    * **输出**：产生 **Observation**（如代码运行结果、报错信息）。
* **Trajectory (短期记忆)**
    * **角色**：当前任务的“流水账”。
    * **内容**：记录了本轮任务中的所有步骤：*Action 1 -> Observation 1 -> Action 2...*
    * **作用**：为后续的评价提供原始素材。

### 2. 核心智能层：评价与反思 (Center & Top)
这是 Reflection 架构的灵魂，负责将“发生了什么”转化为“学到了什么”。

* **Evaluator (评价器)**
    * **角色**：判卷老师。
    * **输入**：读取 **Trajectory**（刚才做过的事）。
    * **功能**：评估当前动作的质量。
    * **输出**：**Internal feedback**（内部反馈），例如判断“方向偏离目标”或“逻辑存在漏洞”。
* **External Feedback (外部反馈)**
    * **来源**：环境的直接报错（如 SyntaxError）或人类用户的直接纠正。
* **Self-reflection (自我反思)**
    * **角色**：大脑 / 补课老师。
    * **功能**：结合 **Internal feedback** 和 **External feedback** 进行深度思考。
    * **关键产出**：**Reflective text (反思文本)**。
    * **本质**：这是一句高度浓缩的经验总结（例如：“我发现解析 JSON 时容易出错，下次应该加个 try-catch”）。

### 3. 进化闭环：经验存储与利用 (Right)
这一步确保 Agent 不会在同一个地方跌倒两次。

* **Experience (长期记忆)**
    * **角色**：错题本 / 经验库。
    * **功能**：存储 **Reflective text**。这些经验独立于当前步骤，长期有效。
* **闭环回归 (Back to Actor)**
    * **逻辑**：当 **Actor** 下一次准备行动时，它**不再仅仅**依赖当前的直觉。
    * **增强**：它会先查阅 **Experience**，根据之前的反思教训，调整自己的策略，生成更优化的 Action。

### 4. Trajectory 与 Experience 区别

#### 🎮 迷宫游戏比喻

假设你在玩一个超级难的迷宫游戏：

**🔵 Trajectory (轨迹)** - 当前这一局的游戏记录

```
向前走 5 步 → 左转 → 撞墙了 → 退回来 → 右转 → ...
```

- **作用**：记录本局游戏的每一步操作
- **生命周期**：仅对当前一局有效
- **重开后**：如果你死了重开一局，这个轨迹就作废了
- **特点**：详细、完整、但易被遗忘

---

**📝 Experience (经验)** - 手边写在纸上的通关秘籍

你不会把前几局走过的每一步都抄在纸上（那太厚了）。你会写：

```
⚠️ 注意！遇到红色的门千万不要进，里面有陷阱。
💡 黄色区域的墙可以穿过，是隐藏通道。
🚫 遇到镜像迷宫时，尝试倒着走。
```

- **作用**：凝结过往经验，指导未来行动
- **生命周期**：跨越多局，长期有效
- **提升**：下一局开始时，先看一眼这张纸，就不会进红色的门了
- **特点**：精炼、关键、易于重用

---

#### 📊 对比表格

| 维度 | Trajectory (轨迹) | Experience (经验) |
|------|------------------|------------------|
| **存储内容** | 本轮所有的 Action 和 Observation | 高度浓缩的学习建议 |
| **作用范围** | 仅本轮任务有效 | 跨任务、长期有效 |
| **信息密度** | 详细、冗余 | 精炼、核心 |
| **来源** | 当前执行过程 | Evaluator 评价后提炼 |
| **应用** | 提供当前上下文 | 指导未来策略 |
| **例子** | "调用搜索 API，得到结果..." | "下次处理 JSON 要加 try-catch" |